import socket
import time

import rospy

def send_packet(string_data):

    UDP_IP = "localhost"
    UDP_Port = 49151
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) 
    sock.sendto(string_data, (UDP_IP, UDP_Port))   

def generate_message(r):

    rate = r
    lwheel = "3000"
    rwheel = "3000"
    angle_min = "-60"
    angle_max = "60"
    scan_time = str(rate)
    range_min = "0"
    range_max = str(35000)

    ranges = [10000. for r in range(120*4)]
    ranges_s = str(ranges)
    #print ranges_s

    # for i in range(num_readings):
    #     ranges.append(i)
    #     if i > 15:
    #         i = 0
    # ranges_s = str(ranges)

    l = [lwheel, rwheel, angle_min, angle_max, scan_time, ranges_s, range_min, range_max]
    robot_string = ';'.join(l)
    rs = "757; 1% -60.00; 60.00; 102; 2237,2210,2157,2121,2069,2027,1980,1929,1814,1748,1717,1686,1657,1632,1614,1587,1565,1539,1537,1527,1520,1518,1515,1492,1473,1455,1422,1406,1392,1378,1344,1329,1315,1309,1304,1268,1265,1235,1227,1214,1211,1199,1186,1145,1143,1140,1136,1126,1102,1092,1075,1072,1062,1058,1036,1033,1020,1002,993,982,982,978,974,974,960,937,936,929,915,912,904,899,899,885,871,867,862,860,858,853,840,836,831,829,823,822,812,798,794,792,787,782,782,768,763,762,760,754,748,739,737,737,734,734,725,720,720,712,710,707,698,696,696,696,696,696,685,674,671,667,664,657,657,652,652,652,651,651,648,648,630,630,629,630,625,625,623,617,608,543,467,451,451,451,451,451,451,459,459,463,466,515,562,570,574,574,572,570,566,565,563,563,563,561,561,558,556,553,553,553,544,544,542,544,542,545,534,538,536,536,533,533,532,531,531,530,531,526,525,517,517,514,517,514,511,511,508,508,509,509,507,507,507,502,502,502,498,498,499,499,499,499,499,493,488,488,491,491,483,480,480,480,483,483,484,484,488,484,484,481,476,474,471,470,470,471,470,472,472,470,468,469,468,469,469,469,468,468,466,463,461,463,461,461,461,467,462,462,462,456,453,453,456,456,454,454,454,454,456,456,456,452,451,451,451,458,466,466,466,453,451,448,448,451,453,453,456,453,453,453,456,459,459,459,459,458,443,431,426,426,426,432,435,435,436,436,437,444,448,448,447,447,427,427,425,419,419,427,433,435,435,438,438,441,442,442,442,431,419,408,408,408,419,431,446,448,450,450,450,450,450,450,454,459,459,459,450,450,450,450,451,456,458,458,456,456,458,458,467,467,467,462,457,450,446,440,438,428,422,422,428,428,428,429,428,428,431,433,434,434,433,430,430,430,439,439,439,434,429,425,425,425,438,440,440,450,450,462,489,502,502,502,488,486,482,479,477,463,463,456,432,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,3000,469,469,475,475,485,485,495,485,492,495,492,492,495,506,507,536,555,555,569,571,571,574,576,576,586,587,587,587,586,582,582,584,582; 0.00; 30000.00"
    
    return rs.translate(None, ' ')
    
scan_time = 1
#rospy.init_node('my_node_name')
#r = rospy.Rate(scan_time)
t = True
while not rospy.is_shutdown():

    pack = generate_message(scan_time)
    send_packet(pack)

    time.sleep(scan_time)

    #crappy test continued
    if t:
        print "Testing ENP"
        #print pack
    t = False








